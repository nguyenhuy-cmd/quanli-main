name: Deploy to Hosting via Git-FTP

on:
  push:
    branches:
      - main
      - new
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy changed files via Git-FTP
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code with history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # cần để git-ftp so sánh diff

      - name: Deploy via Git-FTP (only changed files)
        uses: sebastianpopp/git-ftp-action@3.3.0
        with:
          # Cách 1: dùng secret FTP_SERVER (đã tạo trong Settings > Secrets)
          url: ftp://${{ secrets.FTP_SERVER }}/htdocs/
          # Cách 2 (nếu chưa tạo FTP_SERVER): thay dòng trên bằng:
          # url: ftp://ftpupload.net/htdocs/
          user: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          # auto-init cho lần deploy đầu, insecure để bỏ kiểm tra cert FTPS (phù hợp InfinityFree)
          options: --auto-init --insecure
