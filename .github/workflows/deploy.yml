name: Deploy to Hosting via Git-FTP (Optimized)

# Trigger: chạy mỗi khi push code lên nhánh main
on:
  push:
    branches:
      - main
  workflow_dispatch:  # cho phép chạy thủ công từ GitHub Actions tab

jobs:
  deploy:
    name: Deploy changed files via Git-FTP
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code with history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Lấy toàn bộ git history để so sánh diff
      
      - name: Deploy via Git-FTP (only changed files)
        uses: sebastianpopp/git-ftp-action@v3.3.0
        with:
          url: ftp://${{ secrets.FTP_SERVER }}/htdocs/
          user: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          # Git-FTP tự động phát hiện file thay đổi qua git diff
          # Chỉ upload file đã thay đổi so với lần deploy trước
          options: --insecure
